![# ](/assets/MSDN.jpg)# Matrix多语言需求文档

---
##文档备案

| 版本号 | 修订人| 修改日期 | 修改描述|
|-------:|:-----:|:--------:|:-------:|
|V1.0    |chan   |2017-7-18 |        暂时不写 |


----
## 目录
[toc]

----
##1.背景概述

###1.1背景说明

    >公司业务的扩展，使Matrix面向越来越多的客户。而目前只有一种语言的平台页面，将阻碍来自海外或者的港澳台的客户更方便地使用Matrix。针对来自世界各地的不同客户，Matrix需要做一个多语言的修改。
    
###1.2目标客户
    >面对中国大陆个人用户，机构，本公司管理员以及技术人员。港澳台以及海外的合作机构以及个人用户。
    
----
##2.用户需求及使用场景

###2.1使用场景
>* **场景1：**
港台兄--“咦，打开Matrix之后，为什么默认语言都是简体中文，每次都要手动切换，超机车的”
所以你需要根据客户登陆的Ip地址获取响应的语言信息

>* **场景2：**
“我英语超溜，我不想看简体中文，我要换”
所以你需要在主页面还有子页面中有切换语言的选择
>* **场景3：**
“我想系统记住哥是活在中国的英文大牛，我下次登陆不想再手动切换了”
所以你需要登记用户的语言信息

###2.2用户需求分析
基于以上的场景分析，可以总结出，客户是想要一种直观的，可以让他们无障碍浏览和工作的网站，可以梳理出具体的用户需求如下： 
![![](/assets/1503027180(1).jpg)](/assets/用户需求分析.jpg)

    >1.客户的首次登陆，会按照客户的IP，得到客户所在的国家/地区，然后服务器返回该语言的一个页面，首次登陆不需要客户自己选择语言，服务器判断默认语言。
    >2.客户在登陆之后可以根据自己的语言喜好，选择不同的语言界面
    >3.在第二次登陆，或者点击进入子界面时，服务器会根据储存的客户信息判断出该用户的语言，返回相应页面
    >4.可以快速切换语言，无需等待过长的时间
    
----

##3.信息结构
![](/assets/信息结构.jpg)

----

##4.多语言页面业务流程图
![](/assets/业务流程图.jpg)

----

##5.需求详细说明
###5.1目前多语言网站的实现主要有以下的方式
![](/assets/多语言的实现方式.jpg)

>根据以上的多语言实现方式，可以得出，Matrix的多语言实现方案可以分为以下两种的情况
>>①对于具有相同使用习惯的国家和地区，我们可以使用动态的方式，建立一套共有的页面，根据客户的需求，从服务器上导入相应的json语言配置文件，例如对于中国大陆和香港的客户，他们可以认同为具有相同的网页浏览和使用习惯，所以可以用同一套的界面和样式风格。***参考中国农业银行***
>>②对于不同使用习惯，和不同业务的国家，我们可以使用静态的方式，分别建立一套界面。有利于划分业务，使Matrix针对性更强。***参考中国农业银行***


###5.2字符集的使用.
>因为Matrix的多语言涉及到中文，英文，或者是其他国家的语言，而其中有相当一部分国家的语言文字，可以用一个字节来表示，如果使用utf-16,将所有的文字都用两个字节来表示，将会浪费空间。采用统一的可变长度的字符集utf-8表示，以适应需求。

###5.3
>考虑目标国家的网页使用习惯，有些国家的语言书写习惯是从右到左，例如许多中东地区所使用的阿拉伯语，波斯语和希伯来语等等。所有多语言切换的入口或者是网页导航栏的入口，就应该放在网页的右方了。

###5.4区分语言和切换语言
>对于获取当前用户语言需要的方式，有以下的两种
>>①Accept-Language+Cookie
![](/assets/aL+COOKIE.jpg)
用户首次登陆，根据用户浏览器的Cookie，判断有没有语言记录的信息，如果没有就根据浏览器的Accept-Language返回相应的语言界面，否则，按照cookie的语言信息返回相应的界面。用户更改语言的同时，更改浏览器cookie中的语言信息，下一次登陆的时候，可以根据cookie中的语言信息返回相应的语言界面。
***参考Youtube***
首次输入youtube.com
浏览器默认语言为en，首次登陆，网页会根据浏览器的Accept-Language跳转到该语言的页面
![](/assets/yotube_1.png)
切换语言为中文，返回的响应，有对应的set-cookie，将cookie中的语言信息改为zh-cn，如下图
![](/assets/youtube_4.png)

>>在下一次的重新登陆网址，会根据浏览器中的cookie中的语言信息，直接返回中文的网页
![](/assets/youtube_3.png)

>②IP+Session+Accept-language
![](/assets/ip+session+al.jpg)
***参考Google的多语言实现方式***
用户登陆，首先在session中查找用户的语言信息，如果不存在，根据客户的ip地址查找该用户的地区和语言信息（此处可以调用一些外部的接口实现ip查找地址，例如网易ip查询/谷歌），查找出来的语言信息，存储在session中，对应客户的id。假如查询失败，则根究浏览器的优先语言返回相应的界面，并且把语言信息记录下来。

>>**由于现在的Matrix使用的是session存储用户的信息，如下图，所以使用第二种方案会更加方便地区记录和存储用户的语言信息**
![](/assets/session.jpg)
具体的流程如IP+Session+Accept-language

###5.5配置json文件的Key-value
>当有不同语言需求时，服务器解释到客户的语言信息，返回相应的一套json文件和唯一的一套页面。页面中需要变化的文本信息，将会用一个唯一的Key标记，这个key在json文件中可以找到唯一一个Key与之匹配，并且该文本信息的值，就等于该Key对应的value.

###5.6用户语言信息的保存
>用户语言信息，记录正在session中，与该用户的uid一一对应，根据用户的uid获取对应的语言信息。切换语言时，更该session中用户对应的语言信息，以便用户下一次登陆时不用手动更改自己惯用的语言。

###5.7多语言入口清晰明确
>1.当客户面对一堆陌生文字的时候，可以让客户第一时间知道多语言的入口在哪里，这就需要入口的位置清晰，多语言入口上的文字也应该是一种客户能看到的懂的文字。如下图，在导航栏上，用相应国家的语言标识了入口，清晰明了
![](/assets/农行语言.jpg)

>2.多语言入口清晰明确，在用户错误切换语言的时候更能体现出重要性。如下图为MSDN的多语言切换。用户切换了一种不认识的文字，页面的布局和文字全部改变，而此时，多语言的入口竟然是用一种用户不认识的文字标识，这就大大影响了用户体验
![](/assets/MSDN.jpg)




